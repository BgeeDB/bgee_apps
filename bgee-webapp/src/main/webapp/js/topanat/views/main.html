<div ng-cloak> <!-- class="container-fluid" --> 

    <h1>TopAnat - Gene Expression Enrichment</h1>

    <div id='bgee_introduction'>
	   <p>GO-like enrichment of anatomical terms, mapped to genes by expression patterns.
	       It is possible to run TopAnat using our 
	       <a href='https://bioconductor.org/packages/release/bioc/html/BgeeDB.html' class='external_link' 
	       target='_blank' rel='noopener noreferrer'>BgeeDB R package</a>.
           This is the same as this web-service, but with more flexibility in 
           the choice of parameters and developmental stages, and is based on the 
           <a href='http://www.bioconductor.org/packages/release/bioc/html/topGO.html' class='external_link'
           title='topGO package in Bioconductor' target='_blank' rel='noopener noreferrer'>topGO package</a>.
	   </p>
    </div>


    <form id="queryForm" style="font-size: 14px;" name="queryForm" ng-submit="vm.postForm()" novalidate>

        <input type="hidden" ng-model="vm.isFormValidDevStages" required/>
        <input type="hidden" ng-model="vm.isFormValidDataTypes" required/>

        <div ng-cloak style="position: fixed; top: 10px; right: 10px; width: 100px; background-color: white;">
            <loading></loading>
        </div>

        <!-- <div class="row vert-offset horiz-offset" style="padding-bottom: 20px;"> -->
        <div class="row">
	        <ul ng-cloak class="nav nav-pills">
	            <li ng-class="{'active': vm.showRecentJobsPanel}">
	                <a role="button" ng-click="vm.toggleRecentJobs();">
	                    <span class="glyphicon glyphicon-th-list" aria-hidden="true"></span>
	                    Recent Jobs
	                    <span ng-if="vm.recentJobs.length > 0" class="badge">{{vm.recentJobs.length}}</span>
	                </a>
	            </li>
	            <li>
	                <a href="?page=doc&action=top_anat" role="button">
	                    <span class="glyphicon glyphicon-education" aria-hidden="true"></span>
	                    Documentation
	                </a>
	            </li>
	        </ul>
            <span class="examples">
                <!--  See popover text in help.json -->
                <span class="glyphicon glyphicon-pushpin"></span> Examples 
                <!-- Do not add a trailing slash to the example URLs, see comments in topanat.js -->
                <a class="bgee-loading" href="?page=top_anat#/result/7919f27d143667bc6c137401ce0c91b51e257538"
                   uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="bottom"
                   popover-append-to-body="true" popover-title="Example 1"
                   ng-mouseover="vm.getOnlineHelpForItem('Example 1')">1</a>
                <a class="bgee-loading" href="?page=top_anat#/result/8fce889da7b4519c5792573ed3933032c8122819"
                   uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="bottom"
                   popover-append-to-body="true" popover-title="Example 2"
                   ng-mouseover="vm.getOnlineHelpForItem('Example 2')">2</a>
                <a class="bgee-loading" href="?page=top_anat#/result/e37009ba698919c75d06e81b3eca5d48f78210a0"
                   uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="bottom"
                   popover-append-to-body="true" popover-title="Example 3"
                   ng-mouseover="vm.getOnlineHelpForItem('Example 3')">3</a>
                <a class="bgee-loading" href="?page=top_anat#/result/7e8c74c073be03be4c40810c16c6be06c0bef1be"
                   uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="bottom"
                   popover-append-to-body="true" popover-title="Example 4"
                   ng-mouseover="vm.getOnlineHelpForItem('Example 4')">4</a>
                <a class="bgee-loading" href="?page=top_anat#/result/5fc8ff1fcfed7cfba0f82f82a67b418ce8a709b6"
                   uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="bottom"
                   popover-append-to-body="true" popover-title="Example 5"
                   ng-mouseover="vm.getOnlineHelpForItem('Example 5')">5</a>
            </span>
        </div>

        <div uib-collapse="!vm.showRecentJobsPanel" id="recentjobs" class="row" >

            <div ng-show="vm.recentJobs.length > 0">
                <ul class="list-group" >
                    <li ng-repeat="job in vm.recentJobs" class="list-group-item">
			            <img class="img-topanat-xsmall" uib-tooltip="Species: {{job.species}}"
                            ng-src="{{vm.species_img(job.taxid)}}"> |
                        {{job.creationDate}} |
						<span class="truncate-parent"><span ng-show="job.title" uib-tooltip="{{job.title}}" class="truncate">{{job.title}}</span> |</span>
						<!-- Do not add a trailing slash to the job URL, see comments in topanat.js -->
                        <a class="btn-xs btn-success bgee-loading" style="text-decoration: none;" ng-href="#/result/{{job.hash}}">View Job</a>
                        <a class="btn-xs btn-danger" style="text-decoration: none;" href="" ng-click="vm.removeJob(job);" style="margin-left: 6px;">Remove job</a></li>
                </ul>
            </div>
            <div class="ng-cloak" ng-if="vm.recentJobs.length == 0 && vm.recentJobs">
                No recent jobs stored.
            </div>
        </div>

        <!-- GENE LIST + BACKGROUND + ADVANCED OPTIONS -->
        <div class="row" style="margin-top: 15px;">

            <!-- GENE LIST -->
            <div class="col-sm-4">

                <div class="media gl-label">


                        <img ng-src="{{vm.species_img(vm.selected_taxid)}}" class="img-responsive img-topanat-small pull-right" ng-show="vm.selected_taxid !==''" uib-tooltip="Detected species: {{vm.selected_species}}">


                    <div id="gene-list-media" class="media-body ng-cloak">

                        <h4 class="media-heading gl-sizetransformable" ng-class="{'smaller_head':vm.selected_taxid, 'bigger':!vm.selected_taxid || ((vm.uploader.isUploading || vm.fg_list) && !vm.selected_species)}">Gene list</h4>

						<p ng-show="(vm.uploader.isUploading || vm.fg_list !== '') && !vm.selected_species && !vm.showDevStageError" ng-hide="(!vm.uploader.isUploading && vm.fg_list == '') || vm.selected_species !== '' || vm.showDevStageError" class="smaller">

                            <span>
                                <i class="fa fa-circle-o-notch fa-spin" ></i>
                                Detecting species corresponding to the gene list, retrieving associated  development stages
                            </span>

                        </p>

                        <p ng-show="vm.geneValidationMessage !== ''" ng-hide="vm.geneValidationMessage === '' || vm.showDevStageError" class="smaller">{{vm.geneValidationMessage}}</p>

                        <p ng-show="vm.showDevStageError" ng-hide="!vm.showDevStageError" class="smaller">{{vm
                            .showDevStageError}}</p>

                    </div>

                </div>
                <!--  VI, Dec, 2015: when file upload activated, modify the 'placeholder line below:
                placeholder="Enter a list of Ensembl identifiers, one ID per line, no quotes, no comma. Use same format for file upload."
                 -->
                <textarea name="fg_list" id="fg_list"
                          ng-model="vm.fg_list"

                          ng-trim="false"
                          placeholder="Enter a list of Ensembl identifiers, one ID per line, no quotes, no comma."
                          ng-class="{'error': vm.selected_species !== '' && !vm.isValidSpecies}"
                          rows="8"
                          cols="30"
                          ng-change="vm.getDevStages('fg', vm.fg_list)"
                          ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 600, 'blur': 0 } }"
                          ng-disabled="vm.formSubmitted"
                          class="form-control"
                          required>
                </textarea>
                <!-- VRDL: FIXME: Remove that info when we give to the user the option of
                 choosing a species. In same time, remove filter into CommandTopAnat.getGeneResponse() -->
                <p ng-show="vm.selected_taxid === 9598" ng-hide="vm.selected_taxid !== 9598" class="alert-info small">Currently, analyses on bonobo data are not possible.
                For accessions starting with 'ENSPTRG', selected species is chimpanzee</p>

                <!-- SD, Dec, 2015: To be resurrect for milestone 3 except if Valentine gives us her green light-->
                <!--<div class="row" style="margin-top: 8px;">
                    <span class="col-xs-12">
                        <span class="btn btn-default btn-file" ng-class="{'disabled': vm.formSubmitted}">
                            Upload gene list<input ng-click="vm.fileType='fg'" nv-file-select="" uploader="vm.uploader" type="file" ng-disabled="vm.formSubmitted" />
                        </span>

                        <span class="col-sm-push-3" id="fgprogress" ng-show="!vm.hideq['fg']"
                              ng-repeat="item in vm.uploader.queue">
                            <span ng-show="vm.uploader.isUploading">Uploading:
                            <strong>{{ vm.fileitem['fg'].name }}</strong>
                        {{ item.file.size/1024|number:2 }} KB</span>
                        </span>

                        <span ng-show="vm.showUploaded['fg']">
                            {{ vm.fileitem['fg'].name }} uploaded! <i class="glyphicon glyphicon-ok"></i>
                        </span>

                        <span ng-show="item.isCancel">
                            <i class="glyphicon glyphicon-ban-circle"></i>
                        </span>

                        <span ng-show="item.isError">
                            <i class="glyphicon glyphicon-remove"></i>
                        </span>

                        <div class="progress" style="margin-top: 10px;" ng-show="!vm.hideq['fg']">
                            <div class="progress-bar" role="progressbar" ng-style="{ 'width': vm.uploader.queue[0].progress + '%' }"></div>
                        </div>
                    </span>
                </div>-->
            </div>

            <!-- BACKGROUND -->
            <!-- Adding ng-class to disable/enable works for the spans and h* elements but not for the inputs or the textarea -->
            <div class="col-sm-4 repeat-animation hide-fade" ng-hide="!vm.isValidSpecies">

                <div class="media gl-label">

                    <div class="media-body ng-cloak">

                        <h4 class="media-heading smaller_head">Background<span style="padding-left: 10px; font-size: 13px;" class="glyphicon glyphicon-question-sign" uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="bottom" popover-append-to-body="true" popover-title="Custom background" ng-mouseover="vm.getOnlineHelpForItem('Custom background')"></span></h4>

                        <span class="pull-right btn-group btn-group-xs" style="padding: 10px 5px 0 0;">
                        <button type="button" class="btn" ng-model="vm.isBackgroundChecked" ng-click="vm.selectBackground('checked')" ng-disabled="vm.formSubmitted" ng-class="{'active': vm.isBackgroundChecked === 'checked', 'btn-default': vm.isBackgroundChecked === ''}">Bgee data for {{vm.selected_species}}</button>
                        <button type="button" class="btn" ng-model="vm.isBackgroundChecked" ng-click="vm.selectBackground('')" ng-disabled="vm.formSubmitted" ng-class="{'active': vm.isBackgroundChecked === '', 'btn-default': vm.isBackgroundChecked === 'checked'}">Custom data</button>
                        </span>

                        <p style="margin: 5px 5px 0 0;" ng-show="(vm.uploader.isUploading || vm.bg_list) && !vm.background_species" ng-hide="(!vm.uploader.isUploading && !vm.bg_list) || vm.background_species || (vm.background_species == '' &&
                    vm.isBackgroundChecked == 'checked')">
                            <i class="fa fa-circle-o-notch fa-spin"></i>

                            <span style="font-size: x-small" >
                                <em>Detecting species corresponding to the background, checking consistency with gene list.</em>
                            </span>
                        </p>
                        <p style="margin: 5px 5px 0 0;" ng-show="vm.isValidBackgroundMessage !== ''">
                            <span style="font-size: x-small" >
                                <em>{{vm.isValidBackgroundMessage}}</em>
                            </span>
                        </p>
                    </div>
                </div>

                <!--
                <nav class="navbar navbar-default">
                    &lt;!&ndash;<div>&ndash;&gt;
                        <span class="h5">Background
                            &lt;!&ndash; Spinner from font-awesome &ndash;&gt;
                            <div class="fa fa-circle-o-notch fa-spin" ng-show="(vm.uploader.isUploading || vm.bg_list) && !vm.background_species" ng-hide="(!vm.uploader.isUploading && !vm.bg_list) || vm.background_species || (vm.background_species == '' &&
                vm.isBackgroundChecked == 'checked')"></div>
                            <span style="font-size: x-small" ng-show="(vm.uploader.isUploading || vm.bg_list) && !vm.background_species" ng-hide="(!vm.uploader.isUploading && !vm.bg_list) || vm.background_species || (vm.background_species == '' &&
                vm.isBackgroundChecked == 'checked')">
                                <em>Detecting species corresponding to the background, checking consistency with gene list.</em>
                            </span>
                        </span>
                        <div class="btn-group btn-group-xs" role="group" aria-label="">
                            <button type="button" class="btn" ng-model="vm.isBackgroundChecked" ng-click="vm.selectBackground('checked')" ng-disabled="vm.formSubmitted" ng-class="{'btn-primary': vm.isBackgroundChecked === 'checked', 'btn-default': vm.isBackgroundChecked === ''}">Bgee data for {{vm.selected_species}}</button>
                            <button type="button" class="btn" ng-model="vm.isBackgroundChecked" ng-click="vm.selectBackground('')" ng-disabled="vm.formSubmitted" ng-class="{'btn-primary': vm.isBackgroundChecked === '', 'btn-default': vm.isBackgroundChecked === 'checked'}">Custom data</button>
                        </div>
                        &nbsp;<span class="glyphicon glyphicon-question-sign" uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="bottom" popover-append-to-body="true" popover-title="Custom background" ng-mouseover="vm.getOnlineHelpForItem('Custom background')"></span>
                    &lt;!&ndash;</div>&lt;!&ndash; &ndash;&gt;&ndash;&gt;
                </nav>
-->

                <!-- XXX add the following message at the end of placeholder when file upload enabled:
                     "Use same format for file upload. "-->
                <textarea name="bg_list"
                                         class="form-control"
                                         ng-model="vm.bg_list"
                                         ng-trim="false"
                                         ng-show="(vm.isBackgroundChecked === '') || (vm.isBackgroundChecked === 'checked' && !vm.isValidBackground && vm.bg_list.length > 0)"
                                         placeholder="Ensembl identifiers from {{vm.selected_species}} genome, one ID per line (no quotes, no comma)."
                                         ng-class="{'error': !vm.isValidSpecies}"
                                         ng-change="vm.getDevStages('bg', vm.bg_list)"
                                         ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 600, 'blur': 0 } }"
                                         rows="8"
                                         cols="30"
                                         ng-disabled="(vm.formSubmitted) || (vm.isBackgroundChecked === 'checked' && !vm.isValidBackground && vm.bg_list.length > 0)">
                </textarea>

                <!-- SD, Dec, 2015: To be resurrect for milestone 3 except if Valentine gives us her green light-->
                <!--<div class="row" ng-show="!vm.isBackgroundChecked" ng-hide="vm.isBackgroundChecked"
                     style="margin-top: 8px;">
                        <span class="col-xs-12">
                            <span class="btn btn-default btn-file" ng-class="{'disabled': vm.formSubmitted}">

                                Upload background<input ng-click="vm.fileType='bg'"
                                                        nv-file-select="" uploader="vm.uploader" type="file" ng-disabled="vm.formSubmitted" />
                            </span>

                            <span class="col-sm-push-3" id="bgprogress" ng-show="!vm.hideq['bg']"
                                  ng-repeat="item in vm.uploader.queue">
                                <span ng-show="vm.uploader.isUploading">Uploading:
                                <strong>{{ vm.fileitem['bg'].name }}</strong>
                            {{ item.file.size/1024|number:2 }} KB</span>
                            </span>

                            <span ng-show="vm.showUploaded['bg']">
                                {{ vm.fileitem['bg'].name }} uploaded! <i class="glyphicon glyphicon-ok"></i>
                            </span>

                            <span ng-show="item.isCancel">
                                <i class="glyphicon glyphicon-ban-circle"></i>
                            </span>

                            <span ng-show="item.isError">
                                <i class="glyphicon glyphicon-remove"></i>
                            </span>

                            <div class="progress" style="margin-top: 10px;" ng-show="!vm.hideq['bg']">
                                <div class="progress-bar" role="progressbar" ng-style="{ 'width': vm.uploader.queue[0].progress + '%' }"></div>
                            </div>
                        </span>
                </div>-->
            </div>

            <!-- OPTIONS (DEV STAGES + EXPRESSION TYPE) -->
            <div class="col-sm-4 repeat-animation hide-fade blink_me " ng-hide="!vm.isValidSpecies">

                <div class="media gl-label">

                    <div class="media-body ng-cloak">
                        <h4 class="media-heading smaller_head">Analysis options</h4>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <span class="smallest_head" >Development stages</span>
                        <div ng-repeat="(key, stage) in vm.developmentStages" class="checkbox checkbox-primary" style="padding: 0 0 0 15px;">
                            <label ng-class="{'highlighted': !stage.checked}" class="checklist-label">
                                <input type="checkbox" ng-model="stage.checked"
                                       ng-change="vm.devStagesChecked()"
                                       ng-disabled="vm.formSubmitted">
                                {{stage.name}}
                            </label>
                        </div>
                        <p ng-cloak ng-show="vm.isValidSpecies && !vm.isFormValidDevStages" class="help-block">At least one development stage is required</p>
                    </div>
                    <div class="col-md-6">
                        <div>
                            <span class="smallest_head">Expression types</span>
                            <p class="text-disabled" style="padding: 0 0 0 15px;">Present</p>
                        </div>
                        <div>
                            <span class="smallest_head">With data types:</span>
                            <div ng-repeat="(key, dataType) in vm.data_type.names" class="checkbox checkbox-primary" style="padding:
                         0 0 0 15px;">
                                <label ng-class="{'highlighted': (!dataType.checked && vm.allowedDataTypes.indexOf(dataType.key) != -1), 'span-disabled': vm.allowedDataTypes.indexOf(dataType.key) == -1}" class="checklist-label">&nbsp;&nbsp;<input type="checkbox" ng-model="dataType.checked" ng-change="vm.dataTypesChecked()" ng-disabled="vm.allowedDataTypes.indexOf(dataType.key) == -1 || vm.formSubmitted" />{{dataType.name}}</label>
                            </div>
                            <p ng-cloak ng-show="vm.isValidSpecies && !vm.isFormValidDataTypes" class="help-block small">At least one data type is required</p>
                        </div>

                    </div>
                </div>
            </div>

        </div>


        <div  style="margin-top: 15px; margin-bottom: 15px;">
            <div>
                <a href="" ng-click="vm.isAdvancedOptionsChecked = !vm.isAdvancedOptionsChecked">Advanced options</a>
            </div>

            <div style="margin-top: 5px;" ng-show="vm.isAdvancedOptionsChecked" ng-hide="!vm.isAdvancedOptionsChecked" class="vert-offset form-inline">
                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3 form-group">
                        <label class="control-group" 
                            ng-class="{'highlighted': vm.data_qual !== undefined && vm.data_qual !== null && 
                                vm.data_qual.toUpperCase() !== vm.data_qualDefault.toUpperCase()}">
                            Data quality:&nbsp;
                            <span class="glyphicon glyphicon-question-sign" uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="top" popover-append-to-body="true" popover-title="Data quality" ng-mouseover="vm.getOnlineHelpForItem('Data quality')"></span>
                        </label>
                        <div class="clearfix"></div>
                        <span class="btn-group btn-group-sm">

                            <button ng-repeat="data_quality in vm.data_qualities"
                                    ng-class="{'btn-info': 
                                        ((vm.data_qual === undefined || vm.data_qual === null) &&
                                        data_quality.id.toUpperCase() === vm.data_qualDefault.toUpperCase()) ||
                                        data_quality.id.toUpperCase() === vm.data_qual.toUpperCase(),
                                        'active': 
                                        ((vm.data_qual === undefined || vm.data_qual === null) &&
                                        data_quality.id.toUpperCase() === vm.data_qualDefault.toUpperCase()) ||
                                        data_quality.id.toUpperCase() === vm.data_qual.toUpperCase()}"
                                    type="button"
                                    class="btn btn-default"
                                    ng-model="vm.data_qual"
                                    ng-required="!vm.data_qual"
                                    ng-click="vm.data_qual=data_quality.id"
                                    uib-btn-radio="data_quality.id">{{data_quality.name}}
                            </button>

                        </span>
                    </div>
                    <div class="col-sm-6 col-md-9 col-lg-9 form-group">
                        <label ng-class="{'highlighted': vm.decorr_type != vm.decorr_typeDefault}">
                            Decorrelation type:&nbsp;
                            <span class="glyphicon glyphicon-question-sign" uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="top" popover-append-to-body="true" popover-title="Decorrelation type" ng-mouseover="vm.getOnlineHelpForItem('Decorrelation type')"></span>
                        </label>
                        <div class="clearfix"></div>
                        <span class="btn-group btn-group-sm">

                            <button ng-repeat="decorrelation_type in vm.decorrelation_types"
                                    ng-class="{'btn-primary': decorrelation_type.id === vm.decorr_type, 'notdefault': vm.decorr_type != vm.decorr_typeDefault && decorrelation_type.id === vm.decorr_type}"
                                    type="button"
                                    class="btn btn-default"
                                    ng-model="vm.decorr_type"
                                    ng-required="!vm.decorr_type"
                                    ng-click="vm.decorr_type=decorrelation_type.id"
                                    uib-btn-radio="decorrelation_type.id">{{decorrelation_type.name}}
                            </button>

                        </span>
                    </div>
                </div>
                <hr style="margin-top:5px;margin-bottom:5px;">
                <div class="row row-no-padding">
                    <div class="col-sm-6 col-md-3 col-lg-3 form-group">
                        <label style="margin-right: 15px;" class="col-md-5 text-left" ng-class="{'highlighted': vm.node_size != vm.nodeSizeDefault}"
                               for="node_size">Node&nbsp;size:</label>
                        <input type="number" id="node_size" name="node_size" ng-model="vm.node_size"
                               class="ao-input"
                               required
                                min="0"
                               max="{{vm.max_node_size}}">
                        <span class="glyphicon glyphicon-question-sign" uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="top" popover-append-to-body="true" popover-title="Node size" ng-mouseover="vm.getOnlineHelpForItem('Node size')">
                            </span>
                        <p ng-show="queryForm.node_size.$error.required" class="help-block">The node size is required</p>
                        <p ng-show="queryForm.node_size.$error.number" class="help-block">The node size must be a valid integer</p>
                        <p ng-show="queryForm.node_size.$error.max" class="help-block">The node size smaller than the number of valid background genes</p>

                    </div>
                    <div class="col-sm-6 col-md-9 col-lg-9 form-group">
                        <label style="margin-right: 15px;" class="col-md-2 text-left" for="nb_node" ng-class="{'highlighted': vm.nb_node != vm.nbNodesDefault}">Nb&nbsp;of nodes:</label>
                        <input type="number" id="nb_node" name="nb_node" ng-model="vm.nb_node"
                               class="ao-input" required min="0">
                        <span class="glyphicon glyphicon-question-sign" uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="top" popover-append-to-body="true" popover-title="Number of nodes" ng-mouseover="vm.getOnlineHelpForItem('Number of nodes')">
                        </span>
                        <p ng-show="queryForm.nb_node.$error.required" class="help-block">The number of nodes is required</p>
                        <p ng-show="queryForm.nb_node.$error.number" class="help-block">The number of nodes must be a valid integer</p>
                    </div>
                </div>
                <hr style="margin-top:5px;margin-bottom:5px;">
                <div class="row row-no-padding">

                    <div class="col-sm-6 col-md-3 col-lg-3 form-group">
                        <div>
                            <label style="margin-right: 15px;" class="col-md-5 text-left" for="fdr_thr"
                                   ng-class="{'highlighted': vm.fdr_thr != vm.fdrThresholdDefault}">FDR&nbsp;threshold:</label>
                            <input id="fdr_thr" type="text" name="fdr_thr" ng-model="vm.fdr_thr" class="ao-input" ng-pattern=" /^(0(\.\d+)?|1(\.0+)?)$/" required>
                            <span class="glyphicon glyphicon-question-sign" uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="top" popover-append-to-body="true" popover-title="FDR threshold" ng-mouseover="vm.getOnlineHelpForItem('FDR threshold')">
                                </span>
                            <p ng-show="queryForm.fdr_thr.$invalid" class="help-block">The FDRthreshold must be
                                float between 0 and 1</p>
                            <p ng-show="queryForm.fdr_thr == ''" class="help-block">The FDRthreshold is required</p>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-9 col-lg-9 form-group">
                        <label style="margin-right: 15px;" class="col-md-2 text-left" for="p_value_thr" ng-class="{'highlighted': vm.p_value_thr != vm.pvalueThresholdDefault}">p&#8209;value&nbsp;threshold:</label>
                        <input id="p_value_thr" type="text" name="p_value_thr" ng-model="vm.p_value_thr" class="ao-input" ng-pattern=" /^(0(\.\d+)?|1(\.0+)?)$/" required>
                        <span class="glyphicon glyphicon-question-sign" uib-popover="{{vm.help}}" popover-trigger="mouseenter" popover-placement="top" popover-append-to-body="true" popover-title="p-value threshold" ng-mouseover="vm.getOnlineHelpForItem('p-value threshold')">
                            </span>
                        <p ng-show="queryForm.p_value_thr.$invalid" class="help-block">The p-value threshold must be float</p>
                        <p ng-show="queryForm.p_value_thr == ''" class="help-block">The p-value threshold is required</p>
                    </div>
                </div>
                <hr style="margin-top:5px;margin-bottom:15px;">
            </div>

        </div>

        <!-- SUBMIT BUTTON AND JOB NAME/EMAIL FIELDS -->
        <div class="submit-buttons col-xs-12">
            <div class="row">
				<!-- One button to submit the job -->
				<button class="btn btn-primary btn-lg col-md-2 col-sm-3 col-xs-12"
					type="submit"
					ng-disabled="queryForm.$invalid ||
                        !vm.isValidSpecies ||
                        (vm.isBackgroundChecked === '' && !vm.isValidBackground)"
					ng-show="!vm.formSubmitted && !vm.jobDone">Submit your job
				</button>

				<!-- 2 buttons to display when job is running, 
                     one for canceling job, one fake button that is a link for opening a new TopAnat windows -->
				<a class="btn btn-success btn-lg col-md-2 col-sm-3 col-xs-12"
					target="_blank" rel="noopener noreferrer" href="?page=top_anat"
					ng-show="vm.formSubmitted && !vm.jobDone"
					ng-disabled="!vm.jobId || vm.jobId <= 0"> Start a new job </a>
				<button class="btn btn-danger btn-lg col-md-2 col-sm-3 col-xs-12"
					ng-click="vm.cancelJob()" ng-show="vm.formSubmitted && !vm.jobDone"
					ng-disabled="!vm.jobId || vm.jobId <= 0" type="button">
					Cancel your job</button>

				<!-- 1 button to reset the form -->
				<button class="btn btn-success btn-lg col-md-2 col-sm-3 col-xs-12"
					ng-click="vm.startNewJob()" ng-show="vm.jobDone" type="button">
					Start a new job</button>

				<div class="col-md-8 col-sm-6 col-xs-12" id="input-submit">
				    <div class="row">
						<div class="input-group col-md-4 col-xs-6">
							<span class="input-group-addon" id="email-addon"><i
								class="glyphicon glyphicon-envelope" uib-popover="{{vm.help}}"
								popover-trigger="mouseenter" popover-placement="top"
								popover-append-to-body="true" popover-title="Email"
								ng-mouseover="vm.getOnlineHelpForItem('email')"></i></span> <input
								type="email" ng-model="vm.email" name="email"
								class="form-control" placeholder="Email"
								aria-describedby="email-addon" ng-disabled="vm.formSubmitted">
						</div>
						<div class="input-group col-md-4 col-xs-6">
							<span class="input-group-addon" id="description-addon"><i
								class="glyphicon glyphicon-file" uib-popover="{{vm.help}}"
								popover-trigger="mouseenter" popover-placement="top"
								popover-append-to-body="true" popover-title="Job description"
								ng-mouseover="vm.getOnlineHelpForItem('job name')"></i></span> <input
								type="text" class="form-control" placeholder="Job description"
								aria-describedby="description-addon"
								ng-disabled="vm.formSubmitted" ng-model="vm.job_title"
								ng-maxlength="255" name="description">
						</div>
						<div class="col-md-8 col-xs-12">
						    <div class="row">
								<p ng-show="queryForm.email.$error.email"
									class="alert-danger col-xs-6">No valid email</p>
								<p ng-show="queryForm.description.$error.maxlength"
									class="alert-danger col-xs-offset-6 col-xs-6">
									Max. 255 characters</p>
							</div>
					    </div>
					</div>
				</div>
			</div>
		</div>

    </form>

    <div id="resultContainer" class="row">
        <div ng-show="vm.formSubmitted || vm.message" class="col-md-9 col-xs-12">

            <div id="resultMessage" class="alert alert-info repeat-animation hide-fade show-fade" ng-show="vm.message" ng-class="{'alert-warning': vm.messageSeverity == 'warning', 'alert-success': vm.messageSeverity == 'success'}">
                <i class="fa fa-spinner fa-spin" data-ng-show="!vm.jobDone && vm.formSubmitted && vm.jobStatus != 'DONE'" data-ng-hide="vm.jobStatus == 'DONE'"></i>
                <span ng-bind-html="to_trusted(vm.message)"></span>
            </div>
        </div>

		<div ng-show="vm.jobDone && vm.gridOptions.data.length > 0" class="col-xs-12">
			<div class="vert-offset horiz-offset">
				<div class="row">
				    <div class="col-md-12" ng-show="vm.job_title !== ''" style="padding-bottom: 15px; text-align: center;"><span class="h4">{{vm.job_title}}</span></div>					
						<div class="col-md-6">
						<span class="h5">View:</span>

						<div ng-repeat="analysis in vm.analysisList">
							<span ng-show="vm.getResultNumber(analysis.id) > 0"
								ng-class="{highlighted: vm.isActive == analysis.id}"> <a
								href="" ng-click="vm.getResultByAnalysis(analysis.id)">{{analysis.name}}</a>
								({{vm.getResultNumber(analysis.id)}}) <a
								href="{{vm.zipFileByAnalysis[analysis.id]}}" type="button"
								class="btn btn-default btn-xs"><span
									class="glyphicon glyphicon-download" style="margin-right: 3px;"></span>Download
									Job Archive</a>
							</span> <span ng-show="vm.getResultNumber(analysis.id) == 0">{{analysis.name}}
								(0)</span>
						</div>
					</div>

					<div class="col-md-3">
						<span class="h5">Search:</span>
						<div class="input-group">
							<input type="text" class="form-control" ng-model='vm.filterValue'>
							<span class="input-group-btn"><button
									class="btn btn-default" type="button"
									ng-click='vm.searchResults()'>
									<span class="glyphicon glyphicon-search"></span>
								</button></span>
						</div>

						<button type="button" class="btn btn-default btn-xs"
							ng-click="vm.downloadFilteredResults()">
							<span class="glyphicon glyphicon-download"
								style="margin-right: 3px;"></span>Download Selected
							{{vm.filteredRows.length}} Results
						</button>
					</div>

					<div class="col-md-3">
						<span class="h5">Show:</span>

						<div>
							<select name="nbRowSelector" id="nbRowSelector"
								ng-options="option.name for option in vm.nbRows.availableOptions track by option.id"
								ng-model="vm.nbRows.selectedOption"
								ng-change="vm.changeNumberOfRowsToShow()">
							</select> rows
						</div>
					</div>
				                
				</div>
			</div>

			<div class="row vert-offset">
				<div id="grid1" ui-grid="vm.gridOptions" class="grid" ui-grid-auto-resize ui-grid-resize-columns></div>
			</div>

		</div>
	</div>

</div>
